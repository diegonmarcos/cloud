version: "3.8"

# Central Syslog Collector - Deploy on GCP arch-1
# Receives alerts from all VMs, stores in SQLite

services:
  syslog-central:
    image: balabit/syslog-ng:4.4.0
    container_name: syslog-central
    restart: unless-stopped
    ports:
      - "5514:5514/tcp"
    volumes:
      - ./syslog-ng-central.conf:/etc/syslog-ng/syslog-ng.conf:ro
      - siem-data:/var/log/siem
    networks:
      - security

  # Simple web UI to query alerts (optional)
  siem-api:
    image: python:3.11-slim
    container_name: siem-api
    restart: unless-stopped
    build:
      context: .
      dockerfile: Dockerfile.api
    ports:
      - "127.0.0.1:8080:8080"
    volumes:
      - siem-data:/var/log/siem:ro
      - ./api:/app:ro
    environment:
      - DB_PATH=/var/log/siem/alerts.db
    networks:
      - security

volumes:
  siem-data:

networks:
  security:
    driver: bridge
